# 广告规则需求

## 需求背景

批量广告创建工具预计本周上线，上线了之后需要测试配套的投放规则，运营这边总结了一套投放规则，需要开发来转换成代码上传到Facebook规则库。

因为目前运营总结的规则并没有经过实际的检验，所以只是想检验一下是否能用，所以流程图中的复制、调高止损值之类的操作，均不用实际操作，返回操作记录即可。需要实际操作的，只有暂停投放。



## 简单流程图

![Untitled Diagram (2)](/Users/lee/Downloads/Untitled Diagram (2).png)

## 详细流程图

![Untitled Diagram (3)](/Users/lee/Downloads/Untitled Diagram (3).png)

## 广告规则API介绍

广告规则是在广告规则库中创建和存储的独立对象，至少包含一个 `name`、一个 `evaluation_spec` 和一个 `execution_spec`。规则的基本架构如下所示：

```
curl \
-F 'name=Rule 1' \
-F 'evaluation_spec={
    ...
   }' \
-F 'execution_spec={
    ...
   }' \
-F "access_token=<ACCESS_TOKEN>" \
https://graph.facebook.com/<VERSION>/<AD_ACCOUNT_ID>/adrules_library
```

Facebook 会在成效分析指标或对象元数据字段出现变化时评估实时触发规则，根据设置的时间间隔评估定期触发规则。



## 评估参数

规则的 `evaluation_spec` 的主要目的是确定规则执行操作的对象。`evaluation_type` 用于确定评估方法的类型，包含下列选项：

| 评估类型   | 说明         |
| ---------- | ------------ |
| `SCHEDULE` | 定期触发规则 |
| `TRIGGER`  | 实时触发规则 |



这次需要上传的，除了止损规则是实时触发规则，其他的都是定期触发规则。











# 广告投放数据

规则中大部分的值，都是根据历史投放数据计算出来的。



## 数据样本量

| 时间    | 账号数量 | campaign数量 | adset数量 | ad数量 |
| ------- | -------- | ------------ | --------- | ------ |
| 6.1-8.5 | 8        | 202          | 1192      | 3885   |
| 8.1-8.5 | 6        | 90           | 329       | 845    |



## impression

将所有ad等分10份，得到十个区间，可以看到，impression到达1k+的几率约为20%

若采用3000的线划分，则impression达到3000以上的几率为12.1%

| impressions         | count | ratio  |
| ------------------- | ----- | ------ |
| (0.999, 2.0]        | 450   | 11.58% |
| (2.0, 6.0]          | 339   | 8.73%  |
| (6.0, 16.0]         | 416   | 10.71% |
| (16.0, 31.0]        | 356   | 9.16%  |
| (31.0, 69.0]        | 388   | 9.99%  |
| (69.0, 172.4]       | 382   | 9.83%  |
| (172.4, 408.8]      | 388   | 9.99%  |
| (408.8, 1097.2]     | 389   | 10.01% |
| (1097.2, 4240.4]    | 388   | 9.99%  |
| (4240.4, 8462692.0] | 389   | 10.01% |

### 分国家impression值

将使用历史数据计算出的30%线作为起量与否的判断值。

| 国家 | active广告数量 | avg_impression | 30%线 | 6月1日起总展示数 |
| ---- | -------------- | -------------- | ----- | ---------------- |
| IN   | 1507           | 31848          | 1699  | 47994560         |
| US   | 1096           | 16492          | 9224  | 18074687         |
| ID   | 1164           | 11247          | 2101  | 13091679         |
| BR   | 985            | 11547          | 2272  | 11373648         |
| AR   | 957            | 7187           | 1107  | 6877568          |
| EG   | 1277           | 4002           | 4361  | 5110756          |
| HK   | 662            | 6990           | 2248  | 4627120          |
| DZ   | 1124           | 4025           | 1651  | 4524335          |
| SG   | 708            | 6271           | 2930  | 4439852          |
| PR   | 652            | 6431           | 7236  | 4192717          |
| VN   | 728            | 5270           | 376   | 3836715          |
| GB   | 688            | 5327           | 1867  | 3664997          |
| DE   | 673            | 4574           | 1536  | 3078571          |
| TW   | 669            | 4465           | 2431  | 2986993          |

## install

